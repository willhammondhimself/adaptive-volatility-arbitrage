# Volatility Arbitrage Strategy Configuration

data:
  source: yahoo
  cache_dir: data/cache
  start_date: "2023-01-01"
  end_date: "2024-01-01"
  symbols:
    - SPY  # S&P 500 ETF

backtest:
  initial_capital: 100000.0
  commission_rate: 0.0015  # 0.15% for options (higher than stocks)
  slippage: 0.001  # 0.1% slippage
  position_size_pct: 0.05  # 5% per position
  max_positions: 5
  risk_free_rate: 0.05  # 5% annual

strategy:
  # Entry/Exit Thresholds
  entry_threshold_pct: 5.0  # Enter when spread >= 5%
  exit_threshold_pct: 2.0   # Exit when spread <= 2%

  # Time Constraints
  min_days_to_expiry: 14  # At least 2 weeks
  max_days_to_expiry: 60  # At most 2 months

  # Delta Hedging
  delta_rebalance_threshold: 0.10  # Rehedge when delta > 0.10
  delta_target: 0.0  # Target delta-neutral

  # Position Sizing
  position_size_pct: 5.0  # 5% of capital per trade
  max_vega_exposure: 1000  # Max vega per position
  max_positions: 5

  # Volatility Forecasting
  vol_lookback_period: 30  # 30 days for volatility calculation
  vol_forecast_method: "garch"  # garch, ewma, or historical

  # Risk Management
  max_loss_pct: 50.0  # Stop loss at 50% of premium paid

  # ===== QV STRATEGY CONFIGURATION =====
  # Enable the 6-signal consensus model instead of simple IV-RV spread
  use_qv_strategy: true

  # QV Feature Windows
  rv_window: 20           # Realized volatility lookback
  feature_window: 60      # Z-score calculation window
  regime_window: 252      # Vol percentile window

  # QV Signal Thresholds (lowered from original for more signals)
  pc_ratio_threshold: 0.5       # Put/Call ratio z-score threshold
  skew_threshold: 0.5           # IV skew z-score threshold
  premium_threshold: 0.10       # IV premium threshold (10%)
  term_structure_threshold: 0.0 # Term structure threshold
  volume_spike_threshold: 1.0   # Volume spike z-score threshold
  sentiment_threshold: 0.5      # Near-term sentiment z-score threshold

  # QV Consensus Scoring
  consensus_threshold: 0.15     # Minimum consensus for entry (lowered for more trades)

  # QV Signal Weights (sum to 1.0)
  weight_pc_ratio: 0.20
  weight_iv_skew: 0.20
  weight_iv_premium: 0.15
  weight_term_structure: 0.15
  weight_volume_spike: 0.15
  weight_near_term_sentiment: 0.15

  # QV Regime Scalars (position size multipliers by vol percentile)
  regime_crisis_scalar: 0.5     # Vol >90th percentile - reduce size
  regime_elevated_scalar: 0.75  # Vol 70-90th percentile
  regime_normal_scalar: 1.0     # Vol 30-70th percentile
  regime_low_scalar: 1.2        # Vol 10-30th percentile
  regime_extreme_low_scalar: 1.5 # Vol <10th percentile - increase size

  # Bullish Base Exposure (removed for pure vol arb)
  base_long_bias: 0.0           # No directional bias (was 0.8)
  signal_adjustment_factor: 1.0 # Full signal weight

  # Tiered Position Sizing
  use_tiered_sizing: true
  min_consensus_threshold: 0.15
  position_scaling_method: quadratic
  min_holding_days: 5

  # ===== REGIME DETECTION =====
  # Enable regime-aware trading with HMM/GMM detection
  use_regime_detection: true
  regime_lookback_period: 60  # Days of returns for regime detection
  exit_on_regime_transition: false  # Exit all positions when regime changes

  # Regime-Specific Parameters
  # Maps regime_id to entry/exit thresholds and position sizing
  # Regime 0: Low volatility - tighter thresholds, larger positions
  # Regime 1: Medium volatility - baseline parameters
  # Regime 2: High volatility - wider thresholds, smaller positions
  regime_params:
    0:  # Low volatility regime
      entry_threshold_pct: 3.0  # Enter at 3% spread (more aggressive)
      exit_threshold_pct: 1.5   # Exit at 1.5% spread
      position_size_multiplier: 1.5  # 50% larger positions
      max_vega_multiplier: 1.5
    1:  # Medium volatility regime
      entry_threshold_pct: 5.0  # Baseline threshold
      exit_threshold_pct: 2.0   # Baseline exit
      position_size_multiplier: 1.0  # Baseline size
      max_vega_multiplier: 1.0
    2:  # High volatility regime
      entry_threshold_pct: 8.0  # Enter at 8% spread (more conservative)
      exit_threshold_pct: 3.0   # Exit at 3% spread
      position_size_multiplier: 0.5  # 50% smaller positions
      max_vega_multiplier: 0.5

# Options Data Quality Filters
options:
  min_volume: 10  # Minimum daily volume
  min_open_interest: 50  # Minimum open interest
  max_spread_pct: 0.20  # Max 20% bid-ask spread

volatility:
  method: garch
  lookback_period: 30
  ewma_lambda: 0.94
  garch_p: 1
  garch_q: 1

logging:
  level: INFO
  format: json
  log_dir: logs
  console_output: true
